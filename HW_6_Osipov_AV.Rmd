---
title: "HW_6_Osipov_AV"
output: html_notebook
---

# Домашнее задание 6: расчет выборки при планировании исследования.

Цель: научиться рассчитывать выборку для исследований с различными конечными точками.

Описание ДЗ Посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность, а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

```{r}
# Общие условия для всех задач
alpha <- 0.05  # Уровень значимости
power <- 0.8  # Мощность
dropout_rate <- 0.1  # Доля выбывших
```

### 1. (3 балла) Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20% ( = 0.20) (CV), а разница средних составляет −10% (theta0). Клиницисты сообщают нам, что клинически значимая разница составляет 25% ( = 0.25) (theta1).

```{r}
# Заданные параметры
CV <- 0.2  # Коэффициент вариации (дисперсия = 20%)
theta0 <- -0.1  # Разница средних (эффект)
theta1 <- 0.25  # Клинически значимая разница

# Рассчитываем критические значения Z
Z_alpha <- qnorm(1 - alpha/2)
Z_beta <- qnorm(power)

# Рассчитываем размер выборки
n <- ((Z_alpha + Z_beta)^2 * CV^2) / (2 * (theta1 - abs(theta0))^2)

# Корректируем размер выборки на долю выбывших
n_corrected <- ceiling(n / (1 - dropout_rate))

# Общий размер выборки (учитывая оба периода)
n_total <- n_corrected * 2

# Выводим результат

cat("Размер выборки для каждой группы (n1 = n2):", round(n), "\n")
cat("Общий размер выборки (учитывая оба периода) (n_total):", round(n_total), "\n")
```

### 2. (3 балла) Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна. Пусть клинически значимая разница δ = -0.1 (delta), то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата p2 = 0.65 (p_test), в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1 = 0.85 (p_reference). Соотношение групп равно k = 1 (ratio).

```{r}
# Заданные параметры
delta <- -0.1  # Клинически значимая разница
p2 <- 0.65  # Доля ответов для тестового препарата
p1 <- 0.85  # Доля ответов для препарата сравнения
k <- 1  # Соотношение групп

# Рассчитываем критические значения Z
Z_alpha <- qnorm(1 - alpha/2)
Z_beta <- qnorm(power)

# Рассчитываем размер выборки
n_2 <- ((((Z_alpha + Z_beta)^2) * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2) * k

# Корректируем размер выборки на долю выбывших
n_corrected_2 <- ceiling(n_2 / (1 - dropout_rate))

# Общий размер выборки (учитывая оба периода)
n_total_2 <- n_corrected_2 * 2

# Выводим результат
cat("Размер выборки для каждой группы (n1 = n2):", round(n_2), "\n")
cat("Общий размер выборки (учитывая оба периода) (n_total):", round(n_total_2), "\n")

```

### 3. (4 балла) Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0.5).

```{r}
# Заданные параметры
HR <- 2       # Hazard ratio
p1 <- 0.5     # Соотношение группы 1
p2 <- 0.5     # Соотношение группы 2
d <- 0.8      # Доля пациентов, сталкивающихся с заболеванием

# Нахождение критических значений Z
Z_alpha <- qnorm(1 - alpha/2)
Z_beta <- qnorm(power)

# Расчет размера выборки
n_3 <- ((Z_alpha + Z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)

# Корректируем размер выборки на долю выбывших
n_corrected_3 <- ceiling(n_3/ (1 - dropout_rate))

# Общий размер выборки (учитывая оба периода)
n_total_3 <- n_corrected_3 * 2



# Вывод результатов
cat("Размер выборки для каждой группы (n1 = n2):", round(n_3), "\n")
cat("Общий размер выборки (учитывая оба периода) (n_total):", round(n_total_3), "\n")

```

Как отправить задание на проверку Загрузите файлы на GitHub, в форму приложите ссылку на него. Назовите rmd-файл своими ФИО.

Что нужно отправить: ссылку на репозиторий, который будет содержать rmd-файл с вашим решением.
